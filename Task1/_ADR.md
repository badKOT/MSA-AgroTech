# ADR-001: Выбор архитектуры для MVP мониторинга ферм

**Статус:** ⚠️ На рассмотрении
**Участники:** Архитектор, лид разработки, PO
**Дата:** 2025-08-01

---

## 1. Контекст

Компания «АгроТех Х» имеет 150 тепличных комплексов и занимается свиноводством.
Сейчас перед компанией стоит задача — повысить эффективность в сфере животноводства и по максимуму автоматизировать процессы, связанные с кормлением, безопасностью и мониторингом поголовья скота:
Операторы следят за животными вручную.
Учёт поголовья и кормов может быть автоматизирован.
Нештатные ситуации обнаруживаются с большим лагом, что приводит к издержкам, которые могут быть предотвращены за счет автоматизации мониторинга.

---

## 2. Требования

### Функциональные

Система должна:
- фиксировать признаки беспокойного поведения или драк среди животных и оповещать оператора;
- фиксировать признаки задавливания поросят;
- управлять кормушками и поилками разных производителей;
- оценивать состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее;
- следить за состоянием систем фильтрации воды;
- пересчитывать поголовье;
- следить за запасами еды и прогнозировать расход;
- делать пересчёт животных;
- поддерживать необходимое количество видеокамер для аналитики в реальном времени от разных производителей;
- быть построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью);
- предоставлять базовые метрики для передачи в другие системы;
- поддерживать возможность добавления собственных метрик;
- работать даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой;
- иметь разделение ролей и поддерживать современные способы аутентификации и авторизации;
- иметь API для создания мобильного приложения или веб-приложения.

### Нефункциональные

Система должна:
- обеспечивать достаточно высокую отказоустойчивость 99,95%;
- быть расширяемой, то есть иметь возможность разработать новый функционал без изменений существующего;
- иметь высокую производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения;
- позволять системе видеоаналитики реагировать в реальном времени (миллисекунды).

---

## 3. Решение

### Описание решения (AI-generated)

- **Полный цикл AI** запускается на **Raspberry Pi CM4 + Coral TPU** на каждой ферме.
- Продолжает работать **100% независимо** при полном отсутствии интернета
- **Централизованный сервер** — только для сводной аналитики и бэкапов раз в день.
- Для оповещений — **SMS-шлюз**

### Аргументация

| Критерий         | Обоснование                 |
|------------------|-----------------------------|
| работа без интернета | предоставление аналитики не зависит от наличия связи, т.к. выполняется локально |
| иметь высокую производительность | за счет локальной обработки данных производительность будет высокой и предсказуемой, а задержки, связанные с передачей данных по сети, полностью митигируются |

---

### 4. Альтернативы

| Вариант      | Плюсы    | Минусы    | Почему отклонен    |
|--------------|----------|-----------|--------------------|
| Агенты лишь передают данные с видео-камер, обработка ведется в дата-центре компании | Более простой CI/CD, Быстрый старт на централизованном GPU-сервере | При полном обрыве связи становится недоступна аналитика, Высокая нагрузка в дата-центре, Необходимо закупить GPU-сервер и организовать мониторинг его состояния | Более высокая зависимость от сети |

---

### 5. Риски (AI-generated)

1. **Перегрев Pi в летний период**  
   *Меры:* Корпус IP65 с радиатором + 40 мм вентилятор

2. **Разрастание локальной БД**  
   *Меры:* TTL 72 ч на кадры, метрики – 30 дней

3. **Физический доступ механиков/клинингов**  
   *Меры:* Корпус на ключ + логгер вскрытий (reed switch)
4. **Проблемы с питанием (скачки)**
   *Меры:* Двойной ИБП (NAS + Pi)